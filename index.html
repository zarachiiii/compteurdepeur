<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Compteur d'Angoisse - Twitch</title>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
  <style>
    body { background: transparent; font-family: 'Creepster', Arial, sans-serif; }
    .compteur-angoisse { width: 420px; padding: 30px; background: linear-gradient(135deg, #160D13 75%, #460006 100%);
      border: 3px solid #911C1D; border-radius: 20px; color: #ffe8ea; text-align: center; box-shadow: 0 0 50px #21021D; }
    .titre-angoisse { font-size: 2.2em; letter-spacing: .07em; margin-bottom: 15px; text-shadow: 0 0 18px #d30029b9, 2px 3px 7px #350002; }
    .progress-bg { position: relative; width: 96%; height: 40px; margin: 0 auto 16px auto;
      background: repeating-linear-gradient(135deg, #241, #441 6px, #2c090d 12px, #be0d1b 16px);
      border-radius: 15px; border: 3px solid #5e0810; overflow: hidden; }
    .progress-fg { position: absolute; left: 0; height: 100%; width: 0%; background: linear-gradient(90deg, #dc001a 20%, #441109 100%);
      box-shadow: 0 0 22px #be080a8a; border-radius: 15px 0 0 15px; transition: width 1.0s cubic-bezier(.68,-0.55,.27,1.55);}
    .pourcentage { position: absolute; width: 100%; text-align: center; line-height: 40px; font-size: 1.6em; color: #fff5f8;
      text-shadow: 1px 1px 9px #b10014, 0 0 10px #872;}
    .effet-glitch { animation: shake 5s; color: #ff4e65;
      text-shadow: 2px 2px 19px #b8002aff, 0 0 8px #fbe;}
    @keyframes shake {
      0% { transform: translateX(0);}
      10% { transform: translateX(-8px);}
      20% { transform: translateX(8px);}
      30% { transform: translateX(-3px);}
      40% { transform: translateX(5px);}
      50% { transform: translateX(-8px);}
      60% { transform: translateX(8px);}
      70% { transform: translateX(-5px);}
      80% { transform: translateX(5px);}
      90% { transform: translateX(-6px);}
      100% { transform: translateX(0);}
    }
    .actions { margin-top: 12px; }
    .actions button { background: #440009; color: #ffc6cc; border: 2px solid #c1101a; padding: 6px 17px; border-radius: 12px;
      cursor: pointer; font-family: 'Creepster', Arial, sans-serif; font-size: 1.19em; box-shadow: 0 0 10px #430014;
      letter-spacing: .07em; margin: 0 8px; transition: background .16s;}
    .actions button:hover { background: #900025; color: #fff;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://unpkg.com/tmi.js@1.8.5"></script>
</head>
<body>
  <div class="compteur-angoisse">
    <div class="titre-angoisse" id="titreAngoisse">Compteur d’angoisse</div>
    <div class="progress-bg">
      <div class="progress-fg" id="progressAngoisse"></div>
      <div class="pourcentage" id="pourcentAngoisse">0%</div>
    </div>
    <div class="actions" id="actionsTest">
      <button onclick="ajouterAngoisse()">+ Angoisse</button>
      <button onclick="resetAngoisse()">Reset</button>
    </div>
  </div>
  <script>
    let angoisseActuelle = 0, ANGOISSE_MAX = 15, estGlitch = false, modeTest = true;
    function afficherAngoisse() {
      let pourcent = Math.round((angoisseActuelle / ANGOISSE_MAX) * 100);
      if (pourcent > 100) pourcent = 100;
      anime({targets: '#progressAngoisse', width: pourcent + '%', duration: 900, easing: 'easeOutElastic(1, .8)'});
      document.getElementById('pourcentAngoisse').textContent = `${pourcent}%`;
      const titre = document.getElementById('titreAngoisse');
      if (angoisseActuelle >= ANGOISSE_MAX) {
        if (!estGlitch) {
          titre.textContent = "ANGOISSE À SON PAROXYSME !";
          titre.classList.add("effet-glitch");
          estGlitch = true;
          setTimeout(() => {
            titre.textContent = "Compteur d’angoisse";
            titre.classList.remove("effet-glitch");
            estGlitch = false;
            angoisseActuelle = 0; afficherAngoisse();
          }, 5200);
        }
      } else {
        titre.classList.remove("effet-glitch");
        titre.textContent = "Compteur d’angoisse";
        estGlitch = false;
      }
    }
    function ajouterAngoisse() {
      if(angoisseActuelle < ANGOISSE_MAX) { angoisseActuelle++; afficherAngoisse();}
      else { angoisseActuelle = ANGOISSE_MAX; afficherAngoisse();}
    }
    function resetAngoisse() { angoisseActuelle = 0; afficherAngoisse(); }
    document.addEventListener('DOMContentLoaded', afficherAngoisse);

    // Intégration chat Twitch (modifie le pseudo ci-dessous)
    let client;
    try {
      client = new tmi.Client({ channels: ['zarachiiii'] }); // remplace 'zarachiiii' si besoin
      client.connect();
    } catch (e) {console.warn("Erreur connexion tmi.js");}
    if (typeof tmi !== "undefined") {
      client.on('message', (channel, tags, message, self) => {
        if (self) return;
        if (modeTest) { document.getElementById('actionsTest').style.display = 'none'; modeTest = false; }
        if (message.toLowerCase().includes('!peur')) { ajouterAngoisse(); }
      });
    }
  </script>
</body>
</html>
